<UserControl x:Class="InterdisciplinairProject.Fixtures.Views.FixtureCreateView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:viewmodels="clr-namespace:InterdisciplinairProject.Fixtures.ViewModels"
             
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800"
             d:DataContext="{d:DesignInstance viewmodels:FixtureCreateViewModel}"
             x:Name="RootControl">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />

        <Style x:Key="EditingTextBoxStyle" TargetType="TextBox">
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>
    </UserControl.Resources>

    <DockPanel Margin="10">

        <StackPanel DockPanel.Dock="Top" Margin="0,0,0,10">

            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                <Label Content="Fixture name:" VerticalAlignment="Center" Margin="0,0,10,0" FontWeight="SemiBold"/>
                <TextBox x:Name="FixtureNameTextBox"
                         Text="{Binding FixtureName, UpdateSourceTrigger=PropertyChanged}"
                         TextWrapping="Wrap"
                         VerticalAlignment="Center"
                         Width="200"
                         Padding="3"/>

                <Label Content="DMX Divisies (2-255):" VerticalAlignment="Center" Margin="20,0,10,0" FontWeight="SemiBold"/>

                <Grid Width="Auto" HorizontalAlignment="Left" VerticalAlignment="Center">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBox Grid.Column="0"
                             Text="{Binding DmxDivisionsInput, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                             Width="50"
                             VerticalAlignment="Center"
                             Padding="3"
                             Margin="0,0,5,0"/>

                    <TextBlock Grid.Column="1"
                               Text="✔ OK" 
                               VerticalAlignment="Center"
                               FontWeight="Bold"
                               Foreground="Green"
                               Visibility="{Binding IsDmxDivisionsValid, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                </Grid>
            </StackPanel>

            <Grid Margin="0,0,0,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="200"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Label Grid.Column="0" Content="Manufacturer:" VerticalAlignment="Center" Margin="0,0,10,0" FontWeight="SemiBold"/>

                <ComboBox Grid.Column="1"
                          ItemsSource="{Binding AvailableManufacturers}"
                          SelectedItem="{Binding SelectedManufacturer, Mode=TwoWay}"
                          VerticalAlignment="Center"
                          Padding="3"/>

                <Button Grid.Column="2" 
                        Content="Register new manufacturer" 
                        Command="{Binding RegisterManufacturerCommand}"
                        VerticalAlignment="Center"
                        Padding="5,3"
                        Margin="10,0,0,0"
                        Background="#FF9800"
                        Foreground="White"
                        FontWeight="Bold"/>

                <Button Grid.Column="3" 
                        Content="Add Image" 
                        Command="{Binding AddImageCommand}"
                        VerticalAlignment="Center"
                        Padding="5,3"
                        Margin="10,0,0,0"
                        Background="#77DD11"
                        Foreground="White"
                        FontWeight="Bold"/>
            </Grid>

            <Button Content="+ Add channel" 
                    Padding="10"
                    Margin="0,0,0,10" 
                    Command="{Binding AddChannelCommand}"
                    Background="#1E90FF"
                    Foreground="White"
                    FontWeight="Bold"
                    HorizontalAlignment="Left"/>
        </StackPanel>

        <StackPanel DockPanel.Dock="Bottom"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,8,0,0">

            <Button Content="Save"
                    Width="90" Height="36" Margin="0,0,8,0"
                    Command="{Binding SaveCommand}"
                    IsEnabled="{Binding IsDmxDivisionsValid}"/>

            <Button Content="Cancel"
                    Width="90" Height="36"
                    Command="{Binding CancelCommand}"/>
        </StackPanel>

        <ScrollViewer VerticalScrollBarVisibility="Auto">

            <ListBox x:Name="ChannelsListBox" 
                     ItemsSource="{Binding Channels}"
                     SelectedItem="{Binding SelectedChannel, Mode=TwoWay}"
                     SelectionChanged="ChannelsListBox_SelectionChanged"
                     MouseDoubleClick="ChannelsListBox_MouseDoubleClick"
                     Margin="0">

                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="LightGray" BorderThickness="1" Padding="8" Margin="0,2" Background="White" CornerRadius="3">
                            <StackPanel>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <Path Grid.Column="0"
                                          Data="M2,3 L4,3 L4,5 L2,5 Z M6,3 L8,3 L8,5 L6,5 Z M2,7 L4,7 L4,9 L2,9 Z M6,7 L8,7 L8,9 L6,9 Z M2,11 L4,11 L4,13 L2,13 Z M6,11 L8,11 L8,13 L6,13 Z"
                                          Fill="Gray"
                                          Width="10" Height="16"
                                          VerticalAlignment="Center"
                                          Margin="0,0,8,0"
                                          Cursor="SizeAll"
                                          MouseLeftButtonDown="DragHandle_MouseLeftButtonDown"/>

                                    <TextBox x:Name="EditTextBox" 
                                             Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" 
                                             Visibility="Collapsed" 
                                             Grid.Column="1"
                                             Style="{StaticResource EditingTextBoxStyle}"
                                             KeyDown="EditTextBox_KeyDown" 
                                             FocusManager.IsFocusScope="True"/>

                                    <StackPanel x:Name="DisplayPanel" Orientation="Horizontal" Grid.Column="1">
                                        <TextBlock Text="{Binding Name}" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Grid>

                                <Border x:Name="OptionsPanel" 
                                        Visibility="Collapsed" 
                                        Margin="0,6,0,0" 
                                        Padding="6" 
                                        Background="#F5F7FB" 
                                        CornerRadius="4" 
                                        BorderBrush="#D0D0D0" 
                                        BorderThickness="1">
                                    <StackPanel Orientation="Vertical">
                                        <TextBlock Text="Selecteer kanaal type:" Margin="0,0,0,4" FontWeight="SemiBold"/>
                                        <ComboBox ItemsSource="{Binding AvailableTypes}"
                                                  SelectedItem="{Binding SelectedType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                  Width="180"
                                                  HorizontalAlignment="Left"/>

                                        <StackPanel x:Name="RgbwPanel" Margin="0,10,0,0" Visibility="Collapsed">
                                            <TextBlock Text="Intensiteit (0–255)" FontWeight="SemiBold" Margin="0,0,0,4"/>
                                            <Slider Minimum="0" Maximum="255"
                                                    Value="{Binding Level, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                    TickFrequency="{Binding DataContext.DmxStepSize, ElementName=RootControl}"
                                                    IsSnapToTickEnabled="True"/>

                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                                <TextBlock Text="Waarde: "/>
                                                <TextBlock x:Name="sliderValue" Text="{Binding Level}"/>
                                                <TextBlock Text=" | Stap: " Margin="10,0,0,0"/>
                                                <TextBlock Text="{Binding DataContext.DmxStepSize, ElementName=RootControl, StringFormat={}{0:F1}}"/>
                                            </StackPanel>
                                        </StackPanel>

                                        <StackPanel x:Name="TypeInputPanel" Margin="0,10,0,0" Visibility="Collapsed">
                                            <TextBlock Text="Input value" FontWeight="SemiBold" Margin="0,0,0,4"/>
                                            <TextBox x:Name="inputValue" Text="{Binding Parameter, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Padding="4"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>

                                <Button x:Name="DeleteButton"
                                        Content="Delete"
                                        Padding="6,2"
                                        Margin="0,10,0,10"
                                        Visibility="Collapsed"
                                        Command="{Binding DataContext.DeleteChannelCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                        CommandParameter="{Binding .}"
                                        Background="Red"
                                        Foreground="White"
                                        HorizontalAlignment="Right"/>
                            </StackPanel>
                        </Border>

                        <DataTemplate.Triggers>

                            <DataTrigger Binding="{Binding IsEditing}" Value="True">
                                <Setter TargetName="DisplayPanel" Property="Visibility" Value="Collapsed" />
                                <Setter TargetName="EditTextBox" Property="Visibility" Value="Visible" />
                                <Setter TargetName="EditTextBox" Property="FocusManager.FocusedElement" Value="{Binding ElementName=EditTextBox}" />
                            </DataTrigger>

                            <DataTrigger Binding="{Binding IsExpanded}" Value="True">
                                <Setter TargetName="OptionsPanel" Property="Visibility" Value="Visible" />
                                <Setter TargetName="DeleteButton" Property="Visibility" Value="Visible" />
                            </DataTrigger>

                            <DataTrigger Binding="{Binding SelectedType}" Value="Rood">
                                <Setter TargetName="RgbwPanel" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="TypeInputPanel" Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding SelectedType}" Value="Groen">
                                <Setter TargetName="RgbwPanel" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="TypeInputPanel" Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding SelectedType}" Value="Blauw">
                                <Setter TargetName="RgbwPanel" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="TypeInputPanel" Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding SelectedType}" Value="Wit">
                                <Setter TargetName="RgbwPanel" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="TypeInputPanel" Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>

                            <DataTrigger Binding="{Binding SelectedType}" Value="Lamp">
                                <Setter TargetName="TypeInputPanel" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="RgbwPanel" Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding SelectedType}" Value="Ster">
                                <Setter TargetName="TypeInputPanel" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="RgbwPanel" Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding SelectedType}" Value="Klok">
                                <Setter TargetName="TypeInputPanel" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="RgbwPanel" Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding SelectedType}" Value="Ventilator">
                                <Setter TargetName="TypeInputPanel" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="RgbwPanel" Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </DataTemplate.Triggers>

                    </DataTemplate>
                </ListBox.ItemTemplate>

                <ListBox.ItemContainerStyle>
                    <Style TargetType="ListBoxItem">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsExpanded}" Value="True">
                                <Setter Property="IsSelected" Value="True"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ListBox.ItemContainerStyle>
            </ListBox>
        </ScrollViewer>
    </DockPanel>
</UserControl>